<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../../WEB-INF/template/plantillaTareas.xhtml">

            <ui:define name="content">
              <script type="text/javascript">
                function handleLoginRequest(xhr, status, args) {
                    if(args.validationFailed || !args.loggedIn) {
                        PF('dlg').jq.effect("shake", {times:5}, 100);
                    }
                    else {
                                                
                        PF('dlg').hide();
                        $('#loginLink').fadeOut();
                        window.location.reload();

                    }
                }
            </script>
            <h:outputStylesheet library="css" name="tareas.css" />

                <div class="card"> 

                        <h:form >        
                            <h:outputLink value="javascript:void(0)" onclick="PF('dlg').show();" >
                                  <p:commandButton style="margin-bottom: 20px" value="Añadir tarea"  styleClass="ui-button-raised" type="button"  />

                            </h:outputLink>

                            <p:growl id="growl"   life="2000" />
                                
                            <p:dialog   widgetVar="dlg" resizable="false">
                                <p:inputText id="content" value="#{tareasController.tar.contenido}" required="true" label="content" requiredMessage="La tarea tiene que tener una descripcion"/>
                                <div></div>
                                <p:selectOneMenu id="prioridad" value="#{tareasController.prioridad.idPrioridad}" >
                                   <f:selectItem itemLabel="Selecciona una prioridad" itemValue=""/>
                                   <f:selectItems value="#{tareasController.listaPrioridades}" var="p" itemValue="#{p.idPrioridad}" itemLabel="#{p.nombre}" />
                                    </p:selectOneMenu>
                                <h5>Es importante?</h5>
                                   <p:selectBooleanButton onLabel="Yes" offLabel="No"
                                                          onIcon="pi pi-check" offIcon="pi pi-times" style="width:6rem" value="#{tareasController.tar.importancia}"/>
                                   <p:datePicker id="basic" value="#{tareasController.tar.fechaVencimiento}" placeholder="Horario" />

                                    <f:facet name="footer">
                                        <p:commandButton value="Añadir tarea" update="growl" action="#{tareasController.crearTarea()}"
                                                         oncomplete="handleLoginRequest(xhr, status, args)" />
                                    </f:facet>  
                            </p:dialog>    
                        </h:form>
                </div>
             <div class="card">
                 <h:form id="form">
                     <p:growl id="msgs" life="1500"/>

                     <p:dataTable widgetVar="customersTable" id="basicDT" var="t" value="#{tareasController.listaTareas}" emptyMessage="Introduce tus tareas." editable="true"  filteredValue="#{t.contenido}">
                         <p:ajax event="rowEdit" listener="#{tareasController.onRowEdit}" update=":form:msgs"/>
                         <p:ajax event="rowEditCancel" listener="#{tareasController.onRowCancel}" update=":form:msgs" />

                         <p:effect type="blind" event="update">
                        <f:param name="direction" value="'horizontal'"/>
                            </p:effect>
                                                                          <f:facet name="header">
                <div class="p-d-flex p-ai-center p-jc-between">
                    <div>
                    <p:inputText id="globalFilter" onkeyup="PF('customersTable').filter()" style="width:10rem" placeholder="Enter keyword" />
                    </div>
                </div>

            </f:facet>
            <p:column style="width:3rem;text-align: center">
                
                <p:commandButton  
                    icon="pi pi-circle-off" title="View" actionListener="#{tareasController.eliminarTarea(t)}" update=":form">
                    
                </p:commandButton>
            </p:column>
            <p:column >
                <p:cellEditor>
                    <f:facet name="output">
                      <h:outputText value="#{t.contenido}" />
                    </f:facet>
                    <f:facet name="input">
                        <p:inputText  value="#{t.contenido}"  style="width:100%" label="Contenido"/>
                    </f:facet>
                </p:cellEditor>
            </p:column>{t

           
         <p:column >
                <p:rowEditor editTitle="Edit Row" cancelTitle="Cancel Edit" saveTitle="Save Row"/>
            </p:column>
            
            
        </p:dataTable>
                                         </h:form>

    </div>
            </ui:define>

        </ui:composition>

    </body>
</html>
