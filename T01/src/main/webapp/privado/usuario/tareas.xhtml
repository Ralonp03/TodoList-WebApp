<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../../WEB-INF/template/plantillaTareas.xhtml">

            <ui:define name="content">
              <script type="text/javascript">
                function handleLoginRequest(xhr, status, args) {
                    if(args.validationFailed || !args.loggedIn) {
                        PF('dlg').jq.effect("shake", {times:5}, 100);
                    }
                    else {
                                                
                        PF('dlg').hide();
                        $('#loginLink').fadeOut();
                        window.location.reload();

                    }
                }
            </script>
            <h:outputStylesheet library="css" name="tareas.css" />

                <div class="card"> 

                        <h:form >        
                            <h:outputLink value="javascript:void(0)" onclick="PF('dlg').show();" >
                                  <p:commandButton style="margin-bottom: 20px" value="Añadir tarea"  styleClass="ui-button-raised" type="button"  />

                            </h:outputLink>

                            <p:growl id="growl"   life="2000" />
                                
                            <p:dialog   widgetVar="dlg" resizable="false">
                                <p:inputText id="content" value="#{tareasController.tar.contenido}" required="true" label="content" requiredMessage="La tarea tiene que tener una descripcion"/>
                                <div></div>
                                <p:selectOneMenu id="prioridad" value="#{tareasController.prioridad.idPrioridad}" >
                                   <f:selectItem itemLabel="Selecciona una prioridad" itemValue=""/>
                                   <f:selectItems value="#{tareasController.listaPrioridades}" var="p" itemValue="#{p.idPrioridad}" itemLabel="#{p.nombre}" />
                                    </p:selectOneMenu>
                                <h5>Es importante?</h5>
                                   <p:selectBooleanButton onLabel="Yes" offLabel="No"
                                                          onIcon="pi pi-check" offIcon="pi pi-times" style="width:6rem" value="#{tareasController.tar.importancia}"/>
                                   <p:datePicker id="basic" value="#{tareasController.tar.fechaVencimiento}" placeholder="Horario" />

                                    <f:facet name="footer">
                                        <p:commandButton value="Añadir tarea" update="growl" action="#{tareasController.crearTarea()}"
                                                         oncomplete="handleLoginRequest(xhr, status, args)" />
                                    </f:facet>  
                            </p:dialog>    
                        </h:form>
                </div>
            <div class="card">
              <h:form id="ff">
                  <p:selectManyMenu class="hhh" id="advanced" value="#{tareasController.tareas}" 
                                    onclick="#{tareasController.algo()} " scrollHeight="600" 
                                      var="c" filter="true" filterMatchMode="contains" showCheckbox="true" styleClass="manymenu-advanced">
                      <f:selectItems  value="#{tareasController.listaTareas}" var="tarea" itemLabel="#{tarea.contenido} "
                                      itemValue="#{tarea}" />


                      <p:column>
                          <h:outputText value="#{c.contenido}"/>
                      </p:column>
                      <p:column>
                          <h:outputText value="#{c.importancia}"/>
    
                      </p:column>
                                           <p:column>
                                               <h:outputText value="#{c.idCategoria.nombre}"/>
    
                      </p:column>
                                           <p:column>
                                               <h:outputText value="#{c.idPrioridad.nombre}"/>
                      </p:column>
                  </p:selectManyMenu>
              </h:form>
          </div>
            </ui:define>

        </ui:composition>

    </body>
</html>
